# ูุธุงู ุงููุฏููุนุงุช ูุงูููุงุชูุฑ

## ๐ฏ ูุธุฑุฉ ุนุงูุฉ

ูุธุงู ุงููุฏููุนุงุช ูุงูููุงุชูุฑ ูู ุงููุณุคูู ุนู ุฅุฏุงุฑุฉ ุฌููุน ุงูุนูููุงุช ุงููุงููุฉ ูู ุงููุงุฏู ุงูุฑูุงุถูุ ุจุฏุกูุง ูู ุชุญุตูู ุฑุณูู ุงูุงุดุชุฑุงูุงุชุ ูุฅูุดุงุก ุงูููุงุชูุฑุ ูุชุณุฌูู ุงููุฏููุนุงุชุ ูุฅุฏุงุฑุฉ ุงููุฏููููุงุชุ ูุตููุงู ุฅูู ุฅูุดุงุก ุงูุชูุงุฑูุฑ ุงููุงููุฉ. ูููุฑ ูุฐุง ุงููุธุงู ุฑุคูุฉ ุดุงููุฉ ูููุถุน ุงููุงูู ูููุงุฏู ููุถูู ุฏูุฉ ูุดูุงููุฉ ุฌููุน ุงููุนุงููุงุช ุงููุงููุฉ.

## ๐ ุงููุธุงุฆู ุงูุฑุฆูุณูุฉ

### 1. ุฅุฏุงุฑุฉ ุงูููุงุชูุฑ
- ุฅูุดุงุก ููุงุชูุฑ ููุงุดุชุฑุงูุงุช ูุงูุฎุฏูุงุช
- ุทุจุงุนุฉ ุงูููุงุชูุฑ ุจุชูุณูู PDF
- ุฅุฑุณุงู ุงูููุงุชูุฑ ุจุงูุจุฑูุฏ ุงูุฅููุชุฑููู
- ูุชุงุจุนุฉ ุญุงูุฉ ุงูููุงุชูุฑ (ูุฏููุนุฉุ ุบูุฑ ูุฏููุนุฉุ ูุฏููุนุฉ ุฌุฒุฆููุง)

### 2. ุชุณุฌูู ุงููุฏููุนุงุช
- ุชุณุฌูู ุงููุฏููุนุงุช ุงูููุฏูุฉ
- ุชุณุฌูู ุงููุฏููุนุงุช ุงูุฅููุชุฑูููุฉ
- ุฑุจุท ุงููุฏููุนุงุช ุจุงูููุงุชูุฑ ูุงูุงุดุชุฑุงูุงุช
- ุฅุตุฏุงุฑ ุฅูุตุงูุงุช ูููุฏููุนุงุช

### 3. ุฅุฏุงุฑุฉ ุงููุฏููููุงุช
- ูุชุงุจุนุฉ ุงููุฏููููุงุช ููู ุนุถู
- ุฅุฑุณุงู ุชูุจููุงุช ูููุฏููููุงุช ุงููุชุฃุฎุฑุฉ
- ุฌุฏููุฉ ุงููุฏููููุงุช
- ุชุณุฌูู ุงูุฏูุนุงุช ุงูุฌุฒุฆูุฉ

### 4. ุฅุฏุงุฑุฉ ุงููุตุฑููุงุช
- ุชุณุฌูู ูุตุฑููุงุช ุงููุงุฏู
- ุชุตููู ุงููุตุฑููุงุช
- ูุชุงุจุนุฉ ุงูููุฒุงููุฉ

## ๐๏ธ ููุงุฐุฌ ุจูุงูุงุช ุงููุฏููุนุงุช ูุงูููุงุชูุฑ

### ูููุฐุฌ ุงููุงุชูุฑุฉ

```python
class Invoice(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    invoice_number = db.Column(db.String(20), unique=True, nullable=False)
    member_id = db.Column(db.Integer, db.ForeignKey('member.id'), nullable=False)
    subscription_id = db.Column(db.Integer, db.ForeignKey('subscription.id'), nullable=True)
    invoice_date = db.Column(db.Date, default=date.today)
    due_date = db.Column(db.Date, nullable=True)
    total_amount = db.Column(db.Float, nullable=False)
    paid_amount = db.Column(db.Float, default=0)
    status = db.Column(db.String(20), default='unpaid')  # unpaid, partially_paid, paid
    notes = db.Column(db.Text)
    created_at = db.Column(db.DateTime, default=datetime.utcnow)
    updated_at = db.Column(db.DateTime, default=datetime.utcnow, onupdate=datetime.utcnow)
    created_by = db.Column(db.Integer, db.ForeignKey('user.id'), nullable=True)
    
    # ุงูุนูุงูุงุช
    payments = db.relationship('Payment', backref='invoice', lazy=True)
    items = db.relationship('InvoiceItem', backref='invoice', lazy=True)
```

### ูููุฐุฌ ุนูุงุตุฑ ุงููุงุชูุฑุฉ

```python
class InvoiceItem(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    invoice_id = db.Column(db.Integer, db.ForeignKey('invoice.id'), nullable=False)
    description = db.Column(db.String(200), nullable=False)
    quantity = db.Column(db.Integer, default=1)
    unit_price = db.Column(db.Float, nullable=False)
    total_price = db.Column(db.Float, nullable=False)
    item_type = db.Column(db.String(20), default='subscription')  # subscription, service, product
    item_id = db.Column(db.Integer, nullable=True)  # ูุนุฑู ุงูุนูุตุฑ (ุงุดุชุฑุงูุ ุฎุฏูุฉุ ููุชุฌ)
```

### ูููุฐุฌ ุงููุฏููุนุงุช

```python
class Payment(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    payment_number = db.Column(db.String(20), unique=True, nullable=False)
    member_id = db.Column(db.Integer, db.ForeignKey('member.id'), nullable=False)
    invoice_id = db.Column(db.Integer, db.ForeignKey('invoice.id'), nullable=True)
    payment_date = db.Column(db.DateTime, default=datetime.utcnow)
    amount = db.Column(db.Float, nullable=False)
    payment_method = db.Column(db.String(20), default='cash')  # cash, card, bank_transfer
    reference_number = db.Column(db.String(50), nullable=True)  # ุฑูู ูุฑุฌุนู ููุฏูุน ุงูุฅููุชุฑููู
    notes = db.Column(db.Text)
    created_at = db.Column(db.DateTime, default=datetime.utcnow)
    created_by = db.Column(db.Integer, db.ForeignKey('user.id'), nullable=True)
    payment_type = db.Column(db.String(20), default='income')  # income, expense, refund
```

### ูููุฐุฌ ุงููุตุฑููุงุช

```python
class Expense(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    expense_number = db.Column(db.String(20), unique=True, nullable=False)
    expense_date = db.Column(db.Date, default=date.today)
    amount = db.Column(db.Float, nullable=False)
    category = db.Column(db.String(50), nullable=False)  # rent, utilities, salaries, maintenance, etc.
    description = db.Column(db.Text, nullable=False)
    payment_method = db.Column(db.String(20), default='cash')  # cash, card, bank_transfer
    reference_number = db.Column(db.String(50), nullable=True)
    notes = db.Column(db.Text)
    created_at = db.Column(db.DateTime, default=datetime.utcnow)
    created_by = db.Column(db.Integer, db.ForeignKey('user.id'), nullable=True)
```

## ๐ ุงูุนูุงูุงุช ูุน ุงูุฃูุธูุฉ ุงูุฃุฎุฑู

### 1. ุงูุนูุงูุฉ ูุน ูุธุงู ุงูุฃุนุถุงุก
- ูู ูุงุชูุฑุฉ ููุฏููุนุฉ ุชุฑุชุจุท ุจุนุถู ูุญุฏุฏ
- ูููู ููุนุถู ุฃู ูููู ูู ุนุฏุฉ ููุงุชูุฑ ููุฏููุนุงุช
- ูุชู ูุชุงุจุนุฉ ุงููุฏููููุงุช ููู ุนุถู

### 2. ุงูุนูุงูุฉ ูุน ูุธุงู ุงูุงุดุชุฑุงูุงุช
- ูู ูุงุชูุฑุฉ ูููู ุฃู ุชุฑุชุจุท ุจุงุดุชุฑุงู ูุญุฏุฏ
- ูุชู ุชุญุฏูุซ ุญุงูุฉ ุฏูุน ุงูุงุดุชุฑุงู ุจูุงุกู ุนูู ุงููุฏููุนุงุช
- ูููู ุฅูุดุงุก ููุงุชูุฑ ูุชุฌุฏูุฏ ุงูุงุดุชุฑุงูุงุช

### 3. ุงูุนูุงูุฉ ูุน ูุธุงู ุงูุชูุงุฑูุฑ
- ุชูููุฑ ุจูุงูุงุช ุงููุฏููุนุงุช ูุงูููุงุชูุฑ ููุชูุงุฑูุฑ ุงููุงููุฉ
- ุฅูุดุงุก ุชูุงุฑูุฑ ููุตูุฉ ุนู ุงูุฅูุฑุงุฏุงุช ูุงููุตุฑููุงุช
- ุชุญููู ุงูุจูุงูุงุช ุงููุงููุฉ ูุงุชุฎุงุฐ ูุฑุงุฑุงุช ุฅุฏุงุฑูุฉ

## ๐ ุงูุฅุญุตุงุฆูุงุช ูุงูุชูุงุฑูุฑ

### 1. ุฅุญุตุงุฆูุงุช ุงููุฏููุนุงุช
- ุฅุฌูุงูู ุงูุฅูุฑุงุฏุงุช
- ุฅุฌูุงูู ุงููุตุฑููุงุช
- ุตุงูู ุงูุฑุจุญ
- ูุนุฏู ุงูุชุญุตูู

### 2. ุชูุงุฑูุฑ ุงููุฏููุนุงุช
- ุชูุฑูุฑ ุงูุฅูุฑุงุฏุงุช ุงููููู/ุงูุฃุณุจูุนู/ุงูุดูุฑู/ุงูุณููู
- ุชูุฑูุฑ ุงููุตุฑููุงุช ุญุณุจ ุงููุฆุฉ
- ุชูุฑูุฑ ุงููุฏููููุงุช
- ุชูุฑูุฑ ุงูุฃุฑุจุงุญ ูุงูุฎุณุงุฆุฑ

## ๐ฅ๏ธ ูุงุฌูุงุช ุงููุณุชุฎุฏู

### 1. ุตูุญุฉ ุฅูุดุงุก ูุงุชูุฑุฉ
- ูููุฐุฌ ูุฅุฏุฎุงู ุจูุงูุงุช ุงููุงุชูุฑุฉ
- ุงุฎุชูุงุฑ ุงูุนุถู ูุงูุงุดุชุฑุงู
- ุฅุถุงูุฉ ุนูุงุตุฑ ุงููุงุชูุฑุฉ
- ุญุณุงุจ ุงููุฌููุน

### 2. ุตูุญุฉ ุชุณุฌูู ูุฏููุนุงุช
- ูููุฐุฌ ูุฅุฏุฎุงู ุจูุงูุงุช ุงููุฏููุนุฉ
- ุงุฎุชูุงุฑ ุงูุนุถู ูุงููุงุชูุฑุฉ
- ุชุญุฏูุฏ ุทุฑููุฉ ุงูุฏูุน
- ุฅุตุฏุงุฑ ุฅูุตุงู

### 3. ุตูุญุฉ ุฅุฏุงุฑุฉ ุงููุฏููููุงุช
- ุนุฑุถ ูุงุฆูุฉ ุงููุฏููููุงุช
- ุฎูุงุฑุงุช ููุชุตููุฉ ูุงููุฑุฒ
- ุฅููุงููุฉ ุฌุฏููุฉ ุงููุฏููููุงุช
- ุฅุฑุณุงู ุชูุจููุงุช

### 4. ุตูุญุฉ ุฅุฏุงุฑุฉ ุงููุตุฑููุงุช
- ูููุฐุฌ ูุฅุฏุฎุงู ุจูุงูุงุช ุงููุตุฑููุงุช
- ุชุตููู ุงููุตุฑููุงุช
- ูุชุงุจุนุฉ ุงูููุฒุงููุฉ

## ๐๏ธ ุงูุฎุฏูุงุช ูุงููุธุงุฆู ุงููุชูุฏูุฉ

### 1. ุฅูุดุงุก ูุงุชูุฑุฉ

```python
def create_invoice(member, subscription=None, items=None, notes=None):
    """ุฅูุดุงุก ูุงุชูุฑุฉ ุฌุฏูุฏุฉ"""
    # ุชูููุฏ ุฑูู ูุงุชูุฑุฉ ูุฑูุฏ
    invoice_number = generate_invoice_number()
    
    # ุฅูุดุงุก ุงููุงุชูุฑุฉ
    invoice = Invoice(
        invoice_number=invoice_number,
        member_id=member.id,
        subscription_id=subscription.id if subscription else None,
        invoice_date=date.today(),
        due_date=date.today() + timedelta(days=7),  # ุงุณุชุญูุงู ุจุนุฏ ุฃุณุจูุน
        total_amount=0,  # ุณูุชู ุญุณุงุจู ูุงุญููุง
        status='unpaid',
        notes=notes
    )
    
    # ุฅุถุงูุฉ ุนูุงุตุฑ ุงููุงุชูุฑุฉ
    total_amount = 0
    if items:
        for item in items:
            invoice_item = InvoiceItem(
                invoice=invoice,
                description=item['description'],
                quantity=item['quantity'],
                unit_price=item['unit_price'],
                total_price=item['quantity'] * item['unit_price'],
                item_type=item['item_type'],
                item_id=item['item_id']
            )
            total_amount += invoice_item.total_price
    
    # ุชุญุฏูุซ ุฅุฌูุงูู ุงููุงุชูุฑุฉ
    invoice.total_amount = total_amount
    
    # ุญูุธ ุงููุงุชูุฑุฉ
    db.session.add(invoice)
    db.session.commit()
    
    return invoice
```

### 2. ุชุณุฌูู ูุฏููุนุฉ

```python
def record_payment(member, amount, payment_method, invoice=None, reference_number=None, notes=None):
    """ุชุณุฌูู ูุฏููุนุฉ ุฌุฏูุฏุฉ"""
    # ุชูููุฏ ุฑูู ูุฏููุนุฉ ูุฑูุฏ
    payment_number = generate_payment_number()
    
    # ุฅูุดุงุก ุงููุฏููุนุฉ
    payment = Payment(
        payment_number=payment_number,
        member_id=member.id,
        invoice_id=invoice.id if invoice else None,
        payment_date=datetime.utcnow(),
        amount=amount,
        payment_method=payment_method,
        reference_number=reference_number,
        notes=notes,
        payment_type='income'
    )
    
    # ุชุญุฏูุซ ุญุงูุฉ ุงููุงุชูุฑุฉ ุฅุฐุง ูุงูุช ููุฌูุฏุฉ
    if invoice:
        invoice.paid_amount += amount
        if invoice.paid_amount >= invoice.total_amount:
            invoice.status = 'paid'
        else:
            invoice.status = 'partially_paid'
    
    # ุชุญุฏูุซ ุญุงูุฉ ุฏูุน ุงูุงุดุชุฑุงู ุฅุฐุง ูุงูุช ุงููุงุชูุฑุฉ ูุฑุชุจุทุฉ ุจุงุดุชุฑุงู
    if invoice and invoice.subscription_id:
        subscription = Subscription.query.get(invoice.subscription_id)
        subscription.paid_amount += amount
        if subscription.paid_amount >= subscription.final_price:
            subscription.payment_status = 'fully_paid'
        else:
            subscription.payment_status = 'partially_paid'
    
    # ุญูุธ ุงููุฏููุนุฉ
    db.session.add(payment)
    db.session.commit()
    
    return payment
```

### 3. ุฅูุดุงุก ูุงุชูุฑุฉ PDF

```python
def generate_invoice_pdf(invoice):
    """ุฅูุดุงุก ูุงุชูุฑุฉ ุจุชูุณูู PDF"""
    # ุงุณุชุฎุฏุงู ููุชุจุฉ ูุฅูุดุงุก ููู PDF
    from reportlab.pdfgen import canvas
    from reportlab.lib.pagesizes import letter
    from reportlab.platypus import Table, TableStyle
    from reportlab.lib import colors
    
    # ุฅูุดุงุก ููู PDF
    filename = f"invoice_{invoice.invoice_number}.pdf"
    c = canvas.Canvas(filename, pagesize=letter)
    
    # ุฅุถุงูุฉ ูุนูููุงุช ุงููุงุฏู
    c.setFont("Helvetica-Bold", 16)
    c.drawString(30, 750, "ุงุณู ุงููุงุฏู ุงูุฑูุงุถู")
    c.setFont("Helvetica", 12)
    c.drawString(30, 735, "ุงูุนููุงู: ุดุงุฑุน ุงููุงุฏูุ ุงููุฏููุฉ")
    c.drawString(30, 720, "ุงููุงุชู: 123456789")
    c.drawString(30, 705, "ุงูุจุฑูุฏ ุงูุฅููุชุฑููู: info@gym.com")
    
    # ุฅุถุงูุฉ ูุนูููุงุช ุงููุงุชูุฑุฉ
    c.setFont("Helvetica-Bold", 14)
    c.drawString(400, 750, f"ูุงุชูุฑุฉ ุฑูู: {invoice.invoice_number}")
    c.setFont("Helvetica", 12)
    c.drawString(400, 735, f"ุงูุชุงุฑูุฎ: {invoice.invoice_date.strftime('%Y-%m-%d')}")
    c.drawString(400, 720, f"ุชุงุฑูุฎ ุงูุงุณุชุญูุงู: {invoice.due_date.strftime('%Y-%m-%d')}")
    
    # ุฅุถุงูุฉ ูุนูููุงุช ุงูุนุถู
    member = Member.query.get(invoice.member_id)
    c.setFont("Helvetica-Bold", 14)
    c.drawString(30, 670, "ูุนูููุงุช ุงูุนุถู:")
    c.setFont("Helvetica", 12)
    c.drawString(30, 655, f"ุงูุงุณู: {member.first_name} {member.last_name}")
    c.drawString(30, 640, f"ููุฏ ุงูุนุถููุฉ: {member.member_code}")
    c.drawString(30, 625, f"ุงููุงุชู: {member.phone}")
    
    # ุฅุถุงูุฉ ุนูุงุตุฑ ุงููุงุชูุฑุฉ
    data = [["ุงููุตู", "ุงููููุฉ", "ุงูุณุนุฑ", "ุงูุฅุฌูุงูู"]]
    for item in invoice.items:
        data.append([item.description, item.quantity, item.unit_price, item.total_price])
    
    # ุฅุถุงูุฉ ุงููุฌููุน
    data.append(["ุงููุฌููุน", "", "", invoice.total_amount])
    
    # ุฅูุดุงุก ุฌุฏูู
    table = Table(data, colWidths=[250, 70, 100, 100])
    table.setStyle(TableStyle([
        ('BACKGROUND', (0, 0), (-1, 0), colors.grey),
        ('TEXTCOLOR', (0, 0), (-1, 0), colors.whitesmoke),
        ('ALIGN', (0, 0), (-1, -1), 'CENTER'),
        ('FONTNAME', (0, 0), (-1, 0), 'Helvetica-Bold'),
        ('BOTTOMPADDING', (0, 0), (-1, 0), 12),
        ('BACKGROUND', (0, 1), (-1, -1), colors.beige),
        ('GRID', (0, 0), (-1, -1), 1, colors.black)
    ]))
    
    # ุฑุณู ุงูุฌุฏูู
    table.wrapOn(c, 30, 400)
    table.drawOn(c, 30, 400)
    
    # ุฅุถุงูุฉ ููุงุญุธุงุช
    c.setFont("Helvetica-Bold", 12)
    c.drawString(30, 300, "ููุงุญุธุงุช:")
    c.setFont("Helvetica", 10)
    c.drawString(30, 285, invoice.notes or "")
    
    # ุฅุถุงูุฉ ูุนูููุงุช ุงูุฏูุน
    c.setFont("Helvetica-Bold", 12)
    c.drawString(30, 250, "ูุนูููุงุช ุงูุฏูุน:")
    c.setFont("Helvetica", 10)
    c.drawString(30, 235, "ุทุฑู ุงูุฏูุน ุงููุชุงุญุฉ: ููุฏูุงุ ุจุทุงูุฉ ุงุฆุชูุงูุ ุชุญููู ุจููู")
    
    # ุญูุธ ุงูููู
    c.save()
    
    return filename
```

## ๐ฑ ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู

- ูุงุฌูุฉ ูุณุชุฎุฏู ุณููุฉ ุงูุงุณุชุฎุฏุงู
- ุนูููุฉ ุฅูุดุงุก ุงูููุงุชูุฑ ูุชุณุฌูู ุงููุฏููุนุงุช ุณุฑูุนุฉ ูุณูุณุฉ
- ุนุฑุถ ุฑุณุงุฆู ูุงุถุญุฉ ููุชุฃููุฏ ุฃู ุงูุฎุทุฃ
- ุนุฑุถ ูุนูููุงุช ุงูููุงุชูุฑ ูุงููุฏููุนุงุช ุจุดูู ูุงุถุญ

## ๐ ุงูุฃูุงู ูุงูุตูุงุญูุงุช

- ุชุญุฏูุฏ ุตูุงุญูุงุช ุฅูุดุงุก ุงูููุงุชูุฑ ูุชุณุฌูู ุงููุฏููุนุงุช
- ุชุณุฌูู ุงููุณุชุฎุฏู ุงูุฐู ูุงู ุจุฅูุดุงุก ุงููุงุชูุฑุฉ ุฃู ุชุณุฌูู ุงููุฏููุนุฉ
- ุญูุงูุฉ ุงูุจูุงูุงุช ุงููุงููุฉ ูู ุงูุชุนุฏูู ุบูุฑ ุงููุตุฑุญ ุจู
- ุชุณุฌูู ุฌููุน ุงูุนูููุงุช ุงููุงููุฉ


### 1. ุงูุฏูุน ุงูุฅููุชุฑููู
- ุฏุนู ุจูุงุจุงุช ุงูุฏูุน ุงูุฅููุชุฑููู
- ุฏุนู ุงูุฏูุน ุจุงูุจุทุงูุงุช ุงูุงุฆุชูุงููุฉ
- ุฏุนู ุงููุญุงูุธ ุงูุฅููุชุฑูููุฉ

### 2. ุงูููุงุชูุฑ ุงูุฅููุชุฑูููุฉ
- ุฅุฑุณุงู ุงูููุงุชูุฑ ุจุงูุจุฑูุฏ ุงูุฅููุชุฑููู
- ุฅููุงููุฉ ุงูุฏูุน ุนุจุฑ ุฑุงุจุท ูู ุงููุงุชูุฑุฉ
- ูุชุงุจุนุฉ ุญุงูุฉ ุงููุงุชูุฑุฉ

### 3. ุงูุชูุงุฑูุฑ ุงููุงููุฉ ุงููุชูุฏูุฉ
- ุชูุงุฑูุฑ ุงูุฃุฑุจุงุญ ูุงูุฎุณุงุฆุฑ
- ุชูุงุฑูุฑ ุงูุชุฏูู ุงูููุฏู
- ุชูุงุฑูุฑ ุงูููุฒุงููุฉ
- ุชุญููู ุงูุฅูุฑุงุฏุงุช ูุงููุตุฑููุงุช

## ๐ก ุฃูุถู ุงูููุงุฑุณุงุช

- ุชูุซูู ุฌููุน ุงูุนูููุงุช ุงููุงููุฉ
- ุฅุตุฏุงุฑ ููุงุชูุฑ ูุฅูุตุงูุงุช ูุฌููุน ุงููุฏููุนุงุช
- ูุชุงุจุนุฉ ุงููุฏููููุงุช ุจุดูู ููุชุธู
- ุฅุฑุณุงู ุชูุจููุงุช ูููุฏููููุงุช ุงููุชุฃุฎุฑุฉ
- ุฅูุดุงุก ูุณุฎ ุงุญุชูุงุทูุฉ ููุชุธูุฉ ููุจูุงูุงุช ุงููุงููุฉ
- ูุฑุงุฌุนุฉ ุงูุชูุงุฑูุฑ ุงููุงููุฉ ุจุดูู ุฏูุฑู